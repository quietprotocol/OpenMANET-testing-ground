---
# GovTAK Server deployment role

- name: Ensure GovTAK Server directory exists
  ansible.builtin.file:
    path: "{{ tak_server_dir }}"
    state: directory
    mode: '0755'
  tags:
    - govtak

- name: Ensure GovTAK Server scripts directory exists
  ansible.builtin.file:
    path: "{{ tak_server_scripts_dir }}"
    state: directory
    mode: '0755'
  tags:
    - govtak

- name: Copy GovTAK Server scripts to device
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "{{ tak_server_scripts_dir }}/{{ item | basename }}"
    mode: '0755'
  loop:
    - setup.sh
    - certDP.sh
    - shareCerts.sh
  tags:
    - govtak

- name: Copy docker-compose.arm.yml to device
  ansible.builtin.copy:
    src: docker-compose.arm.yml
    dest: "{{ tak_server_dir }}/docker-compose.arm.yml"
    mode: '0644'
  tags:
    - govtak

- name: Verify deployment
  ansible.builtin.command:
    cmd: ls -lh {{ tak_server_scripts_dir }}/*.sh {{ tak_server_dir }}/docker-compose.arm.yml
  register: govtak_verify
  changed_when: false
  tags:
    - govtak

- name: Display deployment verification
  ansible.builtin.debug:
    msg: "{{ govtak_verify.stdout_lines }}"
  tags:
    - govtak

